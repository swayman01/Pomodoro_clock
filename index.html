<html lang="en-US">
    <html>

    <head>
        <title>Pomodoro</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1  user-scalable=no">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <link rel=" stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!--<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>-->
        <link href='https://fonts.googleapis.com/css?family=Play' rel='stylesheet'>
       
        <style>
            body {
                border-radius: 25px;
         }
         
         .calc {
                border-style: outset;
                border-width: thin;
                padding-top: 10px;
                padding-bottom: 10px;
                background-color: black;
                max-width: 500px;
                border-radius: 25px;
                word-wrap: break-word;
         }
         
         h1 {
                color: white;
         }
         
         .label {
                color: white;
                border-width: 0px;
                background-color: inherit;
         }
         
         .blabel {
                color: white;
                margin-bottom: 0px;
                border: 0px;
                background-color: inherit;
         }
         
         #sessiontime,
         #breaktime {
                color: white;
                margin-bottom: 0px;
                border: 0px;
                background-color: inherit;
         }
         
         #inputs {
                margin: 0px;
         }
         
         #dispwindow {
                /*      border-style: outset;
                border-width: thin;
                border-radius: 5px 5px 5px 5px;*/
                font-family: "Play";
                color: white;
                padding-top: 10px;
                padding-bottom: 10px;
                background-color: inherit;
                margin: auto;
                text-align: center;
                margin-bottom: 10px;
                margin-top: 10px;
                width: 90%;
         }
         
         #display {
                text-align: center;
         }
         
         #display2 {
                text-align: center;
         }
         
         #demo {
                color: white;
         }
         

        </style>
        <!--Thanks to SoundBible.com for the bird calls-->
        <audio id="owl" src="/FreeCodeCamp/horned_owl-Mike_Koenig-1945374932.mp3" media-type="audio.mpeg"></audio>
        <audio id="rooster" src="http://res.cloudinary.com/swayman01/video/upload/v1499886482/Rudy_rooster_crowing-Shelley-1948282641_htnnmz.mp3" media-type="audio.mpeg" preload="auto"></audio>
    </head>

    <body id="body">
        <div class="container calc">
            <div class="text-center">
                <h1 id="title">Pomodoro Clock</h1>
            </div>
            <div id="settings">
                <div>
                    <span class="col-xs-1"> </span>
                    <span id="session" class="col-xs-4 text-center label" type="button"> Start Session</span>
                    <span class="col-xs-2"> </span>
                    <span id="break" class="col-xs-4 text-center label"> Start Break</span>
                    <span class="col-xs-1"> </span>
                </div>
                <br>
                <p id="inputs">
                    <span class="col-xs-1"> </span>
                    <button class="qty col-xs-1 blabel" type="button" data-func="plus" data-field="field1">+</button>
                    <input id="sessiontime" class="text-center col-xs-2" type="text" name="field1" value="60" />
                    <button id="minus" class="qty col-xs-1 blabel" type="button" data-func="minus" data-field="field1">-</button>
                    <span class="col-xs-2"> </span>
                    <button class="qty col-xs-1 blabel" type="button" data-func="plus" data-field="break">+</button>
                    <input id="breaktime" class="text-center col-xs-2" type="text" name="break" value="15" />
                    <button class="qty col-xs-1 blabel" type="button" data-func="minus" data-field="break">-</button>
                    <span class="col-xs-1"> </span>
                </p>
                <br>
                <p><br>
                    <span class="col-xs-1"> </span>
                    <button id="stop" class="col-xs-4 label text-center" type="button">Stop</button>
                    <span class="col-xs-2"> </span>
                    <button id="pause" class="col-xs-4 label text-center" type="button">Pause</button>
                    <span class="col-xs-1"> </span>
                </p>
            </div>
            <br>
            <div id="dispwindow" class="text-center">
                <h3 id="display"><br></h3>
                <h3 id="display2"><br></h3>
                <h2 id="demo"></h2>
            </div>
        </div>
        <footer class="text-center">
            <hr>
            <p id="footer">Written and coded by <a href="https://www.freecodecamp.com/swayman01" target=”_blank”>Steve Wayman.</a></p>
        </footer>
        <script>
            var calcwidth = 500;
var state = "stopped"; //other options include paused, session, break
var substate = "notcycling"; //used to resume on pause
var stopclock = true;
var val;
var distance;
var pauseddistance;
var x;
if ($(window).width() < 500) calcwidth = $(window).width();
$(".calc").css("max-width:", calcwidth);

function nextstate() {
    console.log("nextstate - state: " + state);
    clicked = false;
    if (state === "break") {
        state = "session";
        stopclock = false;
        var valsession = parseInt(document.getElementById("sessiontime").value);
        document.getElementById("display").innerHTML = "DO NOT DISTURB";
        document.getElementById("display2").innerHTML = "Focused Work In Progress";
        if (substate === "notcycling") {
            countdown(valsession);
            return;
        }
        else {
            setTimeout(function() {
                countdown(valsession);
            }, 3000);
            return;
        }
    }
    if (state === "session") {
        state = "break";
        stopclock = false;
        var valbreak = parseInt(document.getElementById("breaktime").value);
        document.getElementById("display").innerHTML = "Time to Recharge";
        document.getElementById("display2").innerHTML = "<br>";
        if (substate === "cycle") {
            setTimeout(function() {
                document.getElementById("display").innerHTML = "Recharging";
                document.getElementById("display2").innerHTML = "<br>";
                countdown(valbreak);
            }, 3000);
            return;
        }
        else {
            substate = "cycle";
            document.getElementById("display").innerHTML = "Recharging";
            document.getElementById("display2").innerHTML = "<br>";
            countdown(valbreak);
            return;
        }
    }
}

function countdown() {
    val = arguments[0];
    var countDownDate = new Date().getTime() + 1000 * 60 * val;
    var now = new Date().getTime();
    distance = countDownDate - now;
    if ((state === "session") && ((distance / (60 * 1000) / val > .1) && (distance > (60 * 1000)))) {
        $(".calc").css("background-color", "#145214");
    }
    if ((state === "break") && (distance > (30 * 1000))) {
        $(".calc").css("background-color", "#90caf9");
    }
    //TODO - use inherit from .calc
    $("h1").css("color", "gray");
    $(".label").css("color", "gray");
    $(".blabel").css("color", "gray");
    $("#session").css("color", "gray");
    $("#sessiontime").css("color", "gray");
    $("#break").css("color", "gray");
    $("#breaktime").css("color", "gray");
    $("#stop").css("color", "gray");
    $("#pause").css("color", "gray");
    // Update the count down every 1 second
    x = setInterval(function() {
        now = new Date().getTime();
        distance = countDownDate - now;
        if ((distance / (60 * 1000) / val <= .1) || (distance <= (60 * 1000))) {
            if (state === "session") {
                $(".calc").css("background-color", "#ECB028");
                //TODO Remove with inherit .calc
                $("h1").css("color", "gray");
                $(".blabel").css("color", "gray");
                $("#session").css("color", "gray");
                $("#break").css("color", "gray");
                $("#stop").css("color", "gray");
                $("#pause").css("color", "gray");
            }
        }
        if (distance <= (30 * 1000)) {
            if (state === "session") {;
                $(".calc").css("background-color", "#FE5B35");
            }
            if (state === "break") {
                $(".calc").css("background-color", "#FD7D01");
            }
        }
        if (distance < 0) {
            console.log("x: " + x + " state: " + state);
            clearInterval(x);
            if (state === "paused") {
                document.getElementById("display").innerHTML = "Clock Paused";
                document.getElementById("display2").innerHTML = "<br>";
                distance = pauseddistance;
                console.log("pauseddistance: " + pauseddistance);
                document.getElementById("demo").innerHTML = Math.floor(pauseddistance % (60)) + "m " +
                    Math.floor((pauseddistance - Math.floor(pauseddistance % (60))) * 60) + "s ";
                stopclock = true;
                return;
            }
            if ((state === "session") || (state === "break")) {
                if (state === "session") {
                    document.getElementById("owl").play();
                    document.getElementById("demo").innerHTML = "(Owl Hooting)";
                }
                if (state === "break") {
                    document.getElementById("rooster").play();
                    document.getElementById("demo").innerHTML = "(Rooster Crowing)";
                }
            }
            setTimeout(function() {
                nextstate();
            }, 12);
            return;
        }
        // Time calculations for days, hours, minutes and seconds
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Output the result in an element with id="demo"
        if (state !== "paused")
            if (minutes > 1) {
                if (seconds < 31)
                    document.getElementById("demo").innerHTML = minutes + " minutes left";
                if (seconds > 30) document.getElementById("demo").innerHTML = minutes + 1 + " minutes left";
            }
        if (minutes === 1) {
            if (seconds > 30) document.getElementById("demo").innerHTML = minutes + 1 + " minutes left";
            if (seconds < 31) document.getElementById("demo").innerHTML = minutes + " minute left ";
        }
        if (minutes < 1) {
            document.getElementById("demo").innerHTML = seconds + " seconds left";
        }

        if (stopclock) {
            if (state === "stopped") {
                document.getElementById("display").innerHTML = "Clock Stopped";
                document.getElementById("display2").innerHTML = "<br>";
                document.getElementById("demo").innerHTML = "<br>";
                $(".calc").css("background-color", "black");
                $(".label").css("color", "white");
                $("h1").css("color", "white");
                document.getElementById("session").innerHTML = "Start Session";
                document.getElementById("break").innerHTML = "Start Break";
            }
            //           distance = -1;
            console.log("x: " + x + " state: " + state);
            clearInterval(x);
        }
    }, 1000);
}

$('.qty').click(function() {
    var $t = $(this),
        $in = $('input[name="' + $t.data('field') + '"]'),
        val = parseInt($in.val()),
        valMax = 100,
        valMin = 5;

    // Check if a number is in the field first
    if (isNaN(val) || val < valMin) {
        // If field value is NOT a number, or
        // if field value is less than minimum,
        // ...set value to 0 and exit function
        $in.val(valMin);
        return false;
    }
    else if (val > valMax) {
        // If field value exceeds maximum,
        // ...set value to max
        $in.val(valMax);
        return false;
    }

    // Perform increment or decrement logic
    if ($t.data('func') == 'plus') {
        if (val < valMax) $in.val(val + 1);
    }
    else {
        if (val > valMin) $in.val(val - 1);
    }
});
$("#stop").click(function() {
    stopclock = true;
    state = "stopped";
    substate = "notcycling";
    clicked = false;
    document.getElementById("display").innerHTML = "Clock Stopped";
    document.getElementById("display2").innerHTML = "<br>";
    document.getElementById("demo").innerHTML = "<br>";
    $(".calc").css("background-color", "black");
    $(".label").css("color", "white");
    $("h1").css("color", "white");
    document.getElementById("session").innerHTML = "Start Session";
    document.getElementById("break").innerHTML = "Start Break";
    //    distance = -1;
    console.log("x: " + x + " state: " + state);
    clearInterval(x);
});
$("#session").click(function() {
    if (state === "session") return;
    if (state === "stopped") {
        state = "break"; //for flip in nextstate
        substate === "notcycling";
        stopclock = false;
        //        setTimeout(function() {
        nextstate();
        //        }, 12);
        return;
    }
    if (state === "break") {
        clearInterval(x);
        substate === "notcycling";
        stopclock = true;
        //        setTimeout(function() {
        nextstate();
        //        }, 12);
        return;
    }
    if (state === "paused") {
        if (substate === "session") {
            document.getElementById("session").innerHTML = "Start Session";
            document.getElementById("display").innerHTML = "DO NOT DISTURB";
            document.getElementById("display2").innerHTML = "Focused Work In Progress";
            state = "session";
            substate = "cycling";
            stopclock = false;
            countdown(pauseddistance);
        }
        if (substate === "break") {
            document.getElementById("break").innerHTML = "Start Break";
            console.log("x: " + x + " state: " + state);
            //            clearInterval(x);
            //                setTimeout(function() {
            state = "break";
            substate = "notcycling";
            stopclock = false;
            nextstate();
            //                }, 12);
        }
    }
});

$("#break").click(function() {
    /* replaced 7/11/17     
        if ((state !== "paused") && (state !== "stopped")) return;
        if (state === "paused") {
            if (substate === "session") {
                document.getElementById("session").innerHTML = "Start Session";
                stopclock = true;
                console.log("x: " + x + " state: " + state);
                clearInterval(x);
                distance = -1;
                setTimeout(function() {
                    state = "session";
                    substate = "notcycling";
                    stopclock = false;
                    nextstate();
                }, 12);
            }
            if (substate === "break") {
                document.getElementById("break").innerHTML = "Start Break";
                document.getElementById("display").innerHTML = "Recharging";
                document.getElementById("display2").innerHTML = "<br>";
                state = "break";
                substate = "cycling";
                stopclock = false;
                countdown(pauseddistance);
            }
        }*/
    if (state === "break") return;
    if (state === "stopped") {
        state = "session"; //for flip in nextstate
        substate === "notcycling";
        stopclock = false;
        //        setTimeout(function() {
        nextstate();
        //        }, 12);
        return;
    }
    if (state === "session") {
        clearInterval(x);
        substate === "notcycling";
        stopclock = true;
        //        setTimeout(function() {
        nextstate();
        //        }, 12);
        return;
    }
    if (state === "paused") {
        if (substate === "session") {
            document.getElementById("session").innerHTML = "Start Session";
            //               stopclock = true;
            console.log("x: " + x + " state: " + state);
            //                clearInterval(x);
            state = "session";
            substate = "notcycling";
            stopclock = false;
            nextstate();
        }
        if (substate === "break") {
            document.getElementById("break").innerHTML = "Start Break";
            document.getElementById("display").innerHTML = "Recharging";
            document.getElementById("display2").innerHTML = "<br>";
            state = "break";
            substate = "cycling";
            stopclock = false;
            countdown(pauseddistance);
        }
    }
});
$("#pause").click(function() {
    if ((state === "stopped") || (state === "paused")) return;
    if ((state === "session") || (state === "break")) {
        pauseddistance = distance / (1000 * 60);
        substate = state;
        if (substate === "session") document.getElementById("session").innerHTML = "Resume Session";
        if (substate === "break") document.getElementById("break").innerHTML = "Resume Break";
        document.getElementById("display").innerHTML = "Clock Paused";
        document.getElementById("display2").innerHTML = "<br>";
        document.getElementById("demo").innerHTML = Math.floor(pauseddistance % (60)) + "m " +
            Math.floor((pauseddistance - Math.floor(pauseddistance % (60))) * 60) + "s ";
        state = "paused";
        stopclock = true;
        distance = -1;
        console.log("x: " + x + " state: " + state);
        clearInterval(x);
        return;
    }
});
/* global $*/

        </script>

    </body>

    </html>
